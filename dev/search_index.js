var documenterSearchIndex = {"docs":
[{"location":"Scenario3/Evaluation_Scenario_3/#Evaluation-Scenario-3","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"using EasyModelAnalysis, LinearAlgebra","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Question-1","page":"Evaluation Scenario 3","title":"Question 1","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/#Setup-Model","page":"Evaluation Scenario 3","title":"Setup Model","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Begin with a basic SIR model without vital dynamics. Calibrate the model parameters using data on cases during the ‘training period’. Then evaluate the model during the out-of-sample ‘test period’.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"To get started with the code, we implemented the basic SIR without vital dynamics directly in ModelingToolkit.jl. This is a version that was written by an epidemiologist at Microsoft Pandemic, Simon Frost, who has become a fan of the TA3 automated simulation tools and wrote an entire repository of tutorials for this software. It is found at https://github.com/epirecipes/sir-julia.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"In there is an SIR without vital dynamics which we took in full.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"@parameters t β=0.05 c=10.0 γ=0.25\n@variables S(t)=990.0 I(t)=10.0 R(t)=0.0\n∂ = Differential(t)\nN = S + I + R # This is recognized as a derived variable\neqs = [∂(S) ~ -β * c * I / N * S,\n    ∂(I) ~ β * c * I / N * S - γ * I,\n    ∂(R) ~ γ * I];\n\n@named sys = ODESystem(eqs);","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"tspan = (0.0, 40.0)\nprob = ODEProblem(sys, [], tspan);\nsol = solve(prob);","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"plot(sol)","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"using Catlab, AlgebraicPetri\nsir = LabelledPetriNet([:S, :I, :R],\n  :inf => ((:S, :I)=>(:I, :I)),\n  :rec => (:I=>:R),\n)\nsir_sys = ODESystem(sir)","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"tspan = (0.0, 40.0)\nu0 = [990, 10, 0]\np = [0.05*10/1000, 0.25]\nsir_prob = ODEProblem(sir_sys, u0, tspan, p);\nsir_sol = solve(sir_prob);","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"plot(sir_sol)","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Perform-Model-Calibration","page":"Evaluation Scenario 3","title":"Perform Model Calibration","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/#Model-Calibration-Unit-Test","page":"Evaluation Scenario 3","title":"Model Calibration Unit Test","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"As a unit test of the model calibration tools, we generated data at the default parameters, then ran the global optimization, to see how well the parameters were recovered.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"dataset = solve(prob, saveat = 0.1)\nt_train = dataset.t[1:201]\nt_test = dataset.t[202:end]\ndata_train = [S => dataset[S][1:201], I => dataset[I][1:201], R => dataset[R][1:201]]\ndata_test = [S => dataset[S][202:end], I => dataset[I][202:end], R => dataset[R][202:end]]","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"fitparams = global_datafit(prob, [β => [0.03, 0.15], c => [9.0, 13.0], γ => [0.05, 0.5]],\n                           t_train, data_train)","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"This then gives the forecasts in the test data:","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"_prob = remake(prob, p = fitparams)\nsol = solve(_prob, saveat = t_test);\nplot(sol, idxs = S)\nplot!(t_test, data_test[1][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"plot(sol, idxs = I)\nplot!(t_test, data_test[2][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"plot(sol, idxs = R)\nplot!(t_test, data_test[3][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"This looks very good and matches the original data, confirming that the inverse problem functionality is functional.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Application-to-Real-Data-from-TA1","page":"Evaluation Scenario 3","title":"Application to Real Data from TA1","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Expect time series data on I + R\nStart with an assumption on the recovery\nPossible additoinal: alternative measure for recovery rate\nModeling assumption: use total infections from 2 weeks ago as R0, determine I0 and S0 from that\nNeed time series for total population of US over time","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Question-2:-Add-Hospitalizations-and-Deaths","page":"Evaluation Scenario 3","title":"Question 2: Add Hospitalizations and Deaths","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Question 2 involves doing the same analysis as question one but on the SIR model with hopsitalizations and deaths included. To establish unit tests, we first showcase building the model and solving inverse problems using the ModelingToolkit version of the model.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"@parameters t β=0.1 c=10.0 γ=0.25 ρ=0.1 h=0.1 d=0.1 r=0.1\n@variables S(t)=990.0 I(t)=10.0 R(t)=0.0 H(t)=0.0 D(t)=0.0\n∂ = Differential(t)\nN = S + I + R + H + D # This is recognized as a derived variable\neqs = [∂(S) ~ -β * c * I / N * S,\n    ∂(I) ~ β * c * I / N * S - γ * I - h * I - ρ * I,\n    ∂(R) ~ γ * I + r * H,\n    ∂(H) ~ h * I - r * H - d * H,\n    ∂(D) ~ ρ * I + d * H];\n\n@named sys2 = ODESystem(eqs);","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"prob2 = ODEProblem(sys2, [], tspan);\nsol = solve(prob2);","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"plot(sol)","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"The inverse problem solving is done via the same functionality as before.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"fitparams2 = global_datafit(prob2, [β => [0.03, 0.15], c => [9.0, 13.0], γ => [0.05, 0.5]],\n                            t_train, data_train)","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Notice that this fit is not as good. That is to be expected because it's fitting the SIRHD model on the SIR model's output data. Thus we should expect that it also does not forecast entirely correctly.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"_prob2 = remake(prob2, p = fitparams2)\nsol = solve(_prob2, saveat = t_test);\nplot(sol, idxs = S)\nplot!(t_test, data_test[1][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"plot(sol, idxs = I)\nplot!(t_test, data_test[2][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"plot(sol, idxs = R)\nplot!(t_test, data_test[3][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"This checks out.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Data-Ask","page":"Evaluation Scenario 3","title":"Data Ask","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Daily time series on number of patients admitted to the hospital all US\ntime series for mortality\n10 gig file on whether hospitalized or not => percentage for the difference in parameters\nPlot the percentage over time by month, see if a constant assumption is okay or not,\nIf not, need to use the time series\nAny factor for underreporting estimate? Wastewater time series","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Evaluate-Model-Forecasts","page":"Evaluation Scenario 3","title":"Evaluate Model Forecasts","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"In order to evaluate the model forecasts, we developed a functional which does the forecasting part with multiple models and puts a score on the forecast result. This score is calculated using the L2 norm. It was added to the EasyModelAnalysis.jl library in https://github.com/SciML/EasyModelAnalysis.jl/pull/129 as part of the evaluation on day 1.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"norm(solve(_prob, saveat = t_test)[S] - data_test[1][2]) +\nnorm(solve(_prob, saveat = t_test)[I] - data_test[2][2]) +\nnorm(solve(_prob, saveat = t_test)[R] - data_test[3][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"norm(solve(_prob2, saveat = t_test)[S] - data_test[1][2]) +\nnorm(solve(_prob2, saveat = t_test)[I] - data_test[2][2]) +\nnorm(solve(_prob2, saveat = t_test)[R] - data_test[3][2])","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Question-3:-Add-Vaccinations","page":"Evaluation Scenario 3","title":"Question 3: Add Vaccinations","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Question 3 is the same analysis as questions 1 and 2 done on a model with vaccination added. In order to build unit tests for the analysis and functionality, we started by building the model with vaccine by hand, awaiting a swap to the version from TA2.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"@parameters t β=0.1 c=10.0 γ=0.25 ρ=0.1 h=0.1 d=0.1 r=0.1 v=0.1\n@parameters t β2=0.1 c2=10.0 ρ2=0.1 h2=0.1 d2=0.1 r2=0.1\n@variables S(t)=990.0 I(t)=10.0 R(t)=0.0 H(t)=0.0 D(t)=0.0\n@variables Sv(t)=990.0 Iv(t)=10.0 Rv(t)=0.0 Hv(t)=0.0 Dv(t)=0.0\n@variables I_total(t)\n\n∂ = Differential(t)\nN = S + I + R + H + D + Sv + Iv + Iv + Hv + Dv # This is recognized as a derived variable\neqs = [∂(S) ~ -β * c * I_total / N * S - v * Sv,\n    ∂(I) ~ β * c * I_total / N * S - γ * I - h * I - ρ * I,\n    ∂(R) ~ γ * I + r * H,\n    ∂(H) ~ h * I - r * H - d * H,\n    ∂(D) ~ ρ * I + d * H, ∂(Sv) ~ -β2 * c2 * I_total / N * Sv + v * Sv,\n    ∂(Iv) ~ β2 * c2 * I_total / N * Sv - γ * I - h2 * I - ρ2 * I,\n    ∂(Rv) ~ γ * I + r2 * H,\n    ∂(Hv) ~ h2 * I - r2 * H - d2 * H,\n    ∂(Dv) ~ ρ2 * I + d2 * H, I_total ~ I + Iv,\n];\n\n@named sys3 = ODESystem(eqs)\nsys3 = structural_simplify(sys3)","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"The unit test analysis code is as follows:","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Data-Asks","page":"Evaluation Scenario 3","title":"Data Asks","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Time series of vaccinations\nHospitalization rate difference due to vaccination?\nRecovery rate difference due to vaccination?\nMortality rate difference due to vaccination? Hospitalized and not hospitalized","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Question-4:-Age-Stratified-Model","page":"Evaluation Scenario 3","title":"Question 4: Age-Stratified Model","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Question 4 is the same analysis as questions 1, 2, and 3 on a model with age-stratification added. In order to build unit tests for the analysis and functionality, we started by building the model with vaccine by hand, awaiting a swap to the version from TA2.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Data","page":"Evaluation Scenario 3","title":"Data","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Previous data that is age stratified is cases, and hospitalizations\n10 stratifications, by 10 years each\nUnderreporting over time?\nData for assumption on recovery rate with respect to age\nAggregated contact matrix for beta over age, from Scenario 1","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Question-5:-Add-Reinfection","page":"Evaluation Scenario 3","title":"Question 5: Add Reinfection","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Question 5 is the same analysis as questions 1, 2, 3, and 4 on a model with reinfection added. In order to build unit tests for the analysis and functionality, we started by building the model with vaccine by hand, awaiting a swap to the version from TA2.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Data-Asks-2","page":"Evaluation Scenario 3","title":"Data Asks","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Change in hospitalization for people who are reinfected\nState of new york, people who reinfected?\nMedian time to reinfection\nIt may require R -> S ===> R -> S2\nMaybe model recovered as vaccinated S?","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Question-6:-New-Data","page":"Evaluation Scenario 3","title":"Question 6: New Data","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Question 6 is currently awaiting data from TA3","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Question-7:-Analysis","page":"Evaluation Scenario 3","title":"Question 7: Analysis","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"For each model, summarize your conclusions about the following:","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Do parameters fit from data seem reasonable and fall within typical ranges you might see in the broader literature? Provide references to support your conclusions.\nDescribe how well the fitted model compares against historical data, both for the ‘training’ and ‘test’ periods.","category":"page"},{"location":"Scenario3/Evaluation_Scenario_3/#Answer","page":"Evaluation Scenario 3","title":"Answer","text":"","category":"section"},{"location":"Scenario3/Evaluation_Scenario_3/","page":"Evaluation Scenario 3","title":"Evaluation Scenario 3","text":"Question 7 is currently awaiting data from TA3","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/#Evaluation-Scenario-1","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"","category":"section"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"This document is the solution set for Scenario 1 of the Jan 2023 DARPA ASKEM program evaluation. Quoted text is the scenario specfification provided by DARPA/MITRE. Unquoted text, code and output are intended to address the question posed in the scenario document, while providing use case illustration for the libraries in question.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"In this scenario, we investigate the effects of different age population distributions on the effect of viral epidemics using a simple SIR model.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"First, we load various packages for model exploration and data loading, which we will use later.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"using EasyModelAnalysis, LinearAlgebra\nusing EasyModelAnalysis.ModelingToolkit: toparam\nusing EasyModelAnalysis.ModelingToolkit.Symbolics: FnType, variables\nusing XLSX, CSV, DataFrames","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/#Stratified-SIR","page":"Evaluation Scenario 1","title":"Stratified SIR","text":"","category":"section"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Scenario Ask: In order to consider more nuanced interventions, we would like for models to account for different age groups and their contact dynamics. Start with a basic SIR model without vital dynamics, and stratify it according to the following questions.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"We begin by creating a basic function that manually creates a stratified SIR model given a list of population buckets. ","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"tf = 600\nconst k = 1000\n@parameters γ=1 / 14 R0=5\nβ = R0 * γ\n\n\"\"\"\n    make_stratified_model(pops; pop_assumption)\n\nGiven a list of population buckets `pops` (of length `n`), manually create a stratified SIR model with full interaction incidence. The SIR parameters\nγ and R0 (and thus β) are inherited from global scope. The function returns\na symbolic handle to the contact matrix `C` as well as a reference to the\nsystem of differential equations that can be used for futher simulations.\n\nThe optional keyword argument `pop_assumption` allows specifying an assumption\non the intial infected distribution. If not passed, one individual is assumed\ninfected in each age bracket.\n\"\"\"\nfunction make_statified_model(pops; pop_assumption = (stratum, pop) -> 1)\n    @variables t S(t) I(t) R(t)\n    D = Differential(t)\n    n_stratify = length(pops)\n    Ns = map(toparam, variables(:N, 1:n_stratify))\n    Ss = map(v -> v(t), variables(:S, 1:n_stratify, T = FnType))\n    Is = map(v -> v(t), variables(:I, 1:n_stratify, T = FnType))\n    Rs = map(v -> v(t), variables(:R, 1:n_stratify, T = FnType))\n    C = map(toparam, variables(:C, 1:n_stratify, 1:n_stratify))\n    uniform_contact_matrix = fill(1 / n_stratify, (n_stratify, n_stratify))\n    defs = Dict()\n\n    for (i, nn) in enumerate(pops)\n        defs[Ns[i]] = nn\n        Ii = pop_assumption(i, nn)\n        defs[Ss[i]] = nn - Ii\n        defs[Is[i]] = Ii\n        defs[Rs[i]] = 0\n    end\n    for i in eachindex(C)\n        defs[C[i]] = uniform_contact_matrix[i]\n    end\n    eqs = [D.(Ss) .~ -β ./ Ns .* Ss .* (C * Is)\n           D.(Is) .~ β ./ Ns .* Ss .* (C * Is) .- γ .* Is\n           @. D(Rs) ~ γ * Is\n           S ~ sum(Ss)\n           I ~ sum(Is)\n           R ~ sum(Rs)]\n    @named model = ODESystem(eqs; defaults = defs)\n    sys = structural_simplify(model)\n    (C, sys)\nend","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/#Question-1","page":"Evaluation Scenario 1","title":"Question 1","text":"","category":"section"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Start with a simple stratification with three age groups: young, middle-aged, and old.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/#Sub-question-1.a.","page":"Evaluation Scenario 1","title":"Sub-question 1.a.","text":"","category":"section"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Begin with a situation where the population size across each age group is uniform: Nyoung = 2k, Nmiddle = 2k, N_old = 2k. Assume only one person in each age group is infectious at the beginning of the simulation. Let gamma = 1/14 days, and let R0 = 5. Assume gamma, beta, and R0 are the same for all age groups.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"i. Simulate this model for the case where the 3x3 contact matrix is uniform (all values in matrix are 0.33)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"N.B.: Uniform 1/n_strata is the default in our model creation function above.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"(C, sys) = make_statified_model((2k, 2k, 2k))\nprob = ODEProblem(sys, [], (0, tf))\nsol = solve(prob)\nplt_a1 = plot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"ii. Simulate this model for the case where there is significant in-group contact preference – you may choose the numbers in the matrix to represent this in- group preference.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"We pick a contact matrix with significant (0.4) in-group interaction and somewhat weak (but differening, to make the plots more interesting) off-diagonal interactions.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"contact_matrix = [0.4  0.05  0.1\n                  0.05 0.4   0.15          \n                  0.1  0.15  0.4]","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"We now use this updated contact matrix to re-run the simulation.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"prob = ODEProblem(sys, [], (0, tf), vec(C .=> contact_matrix))\nsol = solve(prob)\nplt_a2 = plot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"iii. Simulate this model for the case where there is no contact between age groups. You may choose the numbers in the matrix, but ensure it meets the requirement of no contact between age groups.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"prob = ODEProblem(sys, [], (0, tf), vec(C .=> Diagonal(contact_matrix)))\nsol = solve(prob)\nplt_a3 = plot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Simulate social distancing by scaling down the uniform contact matrix by a factor (e.g. multiply by 0.5)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"uniform_matrix = fill(0.33, (3, 3))\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> 0.5 * uniform_matrix))\nsol = solve(prob)\nplt_a4 = plot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Repeat 1.a.iv for the scenario where the young population has poor compliance with social distancing policies, but the old population is very compliant.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"scaling = Diagonal([0.9, 0.8, 0.4])\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> scaling * uniform_matrix))\nsol = solve(prob)\nplt_a5 = plot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Now we combine all the plots into one to allow easy comparison.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"plot(plt_a1, plt_a2, plt_a3, plt_a4, plt_a5, size = (1000, 500))","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Repeat 1.a for a younger-skewing population: N_young = 3k, N_middle = 2k, N_old = 1k","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"(C, sys) = make_statified_model((3k, 2k, 1k))\nprob = ODEProblem(sys, [], (0, tf))\nsol = solve(prob)\nplt_b1 = plot(sol, leg = :topright, title = \"i\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> contact_matrix))\nsol = solve(prob)\nplt_b2 = plot(sol, leg = :topright, title = \"ii\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> Diagonal(contact_matrix)))\nsol = solve(prob)\nplt_b3 = plot(sol, leg = :topright, title = \"iii\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> 0.5 * uniform_matrix))\nsol = solve(prob)\nplt_b4 = plot(sol, leg = :topright, title = \"iv\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> scaling * uniform_matrix))\nsol = solve(prob)\nplt_b5 = plot(sol, leg = :topright, title = \"v\")\nplot(plt_b1, plt_b2, plt_b3, plt_b4, plt_b5, size = (1000, 500))","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Repeat 1.a for an older-skewing population: N_young = 1k, N_middle = 2k, N_old = 3k","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"(C, sys) = make_statified_model((1k, 2k, 3k))\nprob = ODEProblem(sys, [], (0, tf))\nsol = solve(prob)\nplt_c1 = plot(sol, leg = :topright, title = \"i\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> contact_matrix))\nsol = solve(prob)\nplt_c2 = plot(sol, leg = :topright, title = \"ii\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> Diagonal(contact_matrix)))\nsol = solve(prob)\nplt_c3 = plot(sol, leg = :topright, title = \"iii\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> 0.5 * uniform_matrix))\nsol = solve(prob)\nplt_c4 = plot(sol, leg = :topright, title = \"iv\")\n\nprob = ODEProblem(sys, [], (0, tf), vec(C .=> scaling * uniform_matrix))\nsol = solve(prob)\nplt_c5 = plot(sol, leg = :topright, title = \"v\")\nplot(plt_c1, plt_c2, plt_c3, plt_c4, plt_c5, size = (1000, 500))","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"d. Compare simulation outputs from 1a-c, and describe any takeaways/conclusions.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"The most difference between age demographics can be seen in the case where there are social-distancing compliance differences. We complare these plots here:","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"plot(plt_a5, plt_b5, plt_c5)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/#Question-2","page":"Evaluation Scenario 1","title":"Question 2","text":"","category":"section"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Now find real contact matrix data and stratify the basic SIR model with the appropriate number of age groups to match the data found. To simulate the model with realistic initial values, find data on population distribution by age group. As in question 1, let gamma = 1/14 days, and let R0 = 5. Assume gamma, beta, and R0 are the same for all age groups.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"TA1 provided the data from \"Projecting social contact matrices in 152 countries using contact surveys and demographic data\" by Prem, et al. This paper comes with 10 Excel files that provide contact matrices for 152 countries at work, home, school and other locations (plus a data set of the sum of these locations). The data values in these excel files are raw, averaged survey results.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"note: Note\nWe make no attempt to normalize or otherwise adjust the contact matrices. The interpretation of the contact matrices needs to be consistent with the SIR parameter β, which is fixed in our the given scenario. In a real world case, care would need to be taken to match the units of the contact matrix to the units of β.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"# Load contact matrices\nxf_all_locations1 = XLSX.readxlsx(\"data/MUestimates_all_locations_1.xlsx\")\nxf_all_locations2 = XLSX.readxlsx(\"data/MUestimates_all_locations_2.xlsx\")\nxf_work1 = XLSX.readxlsx(\"data/MUestimates_work_1.xlsx\")\nxf_work2 = XLSX.readxlsx(\"data/MUestimates_work_2.xlsx\")\nxf_school1 = XLSX.readxlsx(\"data/MUestimates_school_1.xlsx\")\nxf_school2 = XLSX.readxlsx(\"data/MUestimates_school_2.xlsx\")\nxf_home1 = XLSX.readxlsx(\"data/MUestimates_home_1.xlsx\")\nxf_home2 = XLSX.readxlsx(\"data/MUestimates_home_2.xlsx\")\nxf_other1 = XLSX.readxlsx(\"data/MUestimates_other_locations_1.xlsx\")\nxf_other2 = XLSX.readxlsx(\"data/MUestimates_other_locations_2.xlsx\")\n\nxfs1 = (; all = xf_all_locations1, work = xf_work1, school = xf_school1,\n        home = xf_home1, other = xf_other1)\nxfs2 = (; all = xf_all_locations2, work = xf_work2, school = xf_school2,\n        home = xf_home2, other = xf_other2)\n\nto_cm(sheet) = Float64[sheet[i, j] for i in 2:17, j in 1:16]","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"We begin by loading up the relevant data for Belgium and quickly visualizing the contract matrix.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"# Load Belgium contact matrix\ncm_belg = to_cm(xf_all_locations1[\"Belgium\"])\nheatmap(cm_belg, yflip=true)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"heatmap(cm_belg)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Next we load the population distribution data.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"pop_belg = values(CSV.read(\"data/2022_ Belgium_population_by_age.csv\", DataFrame,\n                           header = 3)[1, 2:17])\nbar(1:length(pop_belg), collect(pop_belg), permute=(:x, :y), xlabel=\"Age (5 year buckets)\", ylabel=\"Total # of people\", leg=:none)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"# Set up model\n# Per MITRE: Assume that the same fixed fraction of the population in each stratum is initially infected. Here: 0.01%\npop_assumption(_, nn) = nn * 0.0001\n(Cbelg, sys_belg) = make_statified_model(pop_belg; pop_assumption)\n\nprob = ODEProblem(sys_belg, [], (0, tf), vec(Cbelg .=> cm_belg))\nsol = solve(prob)\nplot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"If the data you’ve found supports this, compare the situation for a country with significant multi-generational contact beyond two generations (as indicated by multiple contact matrix diagonal bandings), and for a country without.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"TA1 advises that India has significant multi-generational contact, while Belgium does not. We repeat the exercise for India.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"# Load India contact matrix\ncm_india = to_cm(xf_all_locations1[\"India\"])\nhm = heatmap(cm_india, yflip=true)\n\n# Load India population distribution\npop_india = values(CSV.read(\"data/2016_india_population_by_age.csv\", DataFrame)[1, 3:18])\nbar_india = bar(1:length(pop_india), collect(pop_india), permute=(:x, :y), xlabel=\"Age (5 year buckets)\", ylabel=\"Total # of people\", leg=:none)\nplot(hm, bar_india)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"(Cindia, sys_india) = make_statified_model(pop_india; pop_assumption)\nprob = ODEProblem(sys_india, [], (0, tf), vec(Cindia .=> cm_india))\nsol = solve(prob)\nplot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"If the data supports this, try implementing interventions like: (1) School closures (2) Social distancing at work and other locations, but not at home.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"(1) School closures","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Prem et al Supplementary info, page 20","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"function cm_school(xfs, country)\n    to_cm(xfs[:home][country]) + to_cm(xfs[:work][country]) + to_cm(xfs[:other][country])\nend # no school\n\ncm_belgium_school_closure = cm_school(xfs1, \"Belgium\")\nprob = ODEProblem(sys_belg, [], (0, tf), vec(Cbelg .=> cm_belgium_school_closure))\nsol = solve(prob)\nplot(sol, leg = :topright)","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"(2) Social distancing at work and other locations, but not at home.","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"Prem et al sets social distancing to reduce contacts by half","category":"page"},{"location":"Scenario1/Evaluation_Scenario_1/","page":"Evaluation Scenario 1","title":"Evaluation Scenario 1","text":"function cm_social_dist(xfs, country)\n    to_cm(xfs[:home][country]) + 0.5 * to_cm(xfs[:work][country]) +\n    0.5 * to_cm(xfs[:school][country]) + 0.5 * to_cm(xfs[:other][country])\nend\n\ncm_belgium_social_dist = cm_social_dist(xfs1, \"Belgium\")\nprob = ODEProblem(sys_belg, [], (0, tf), vec(Cbelg .=> cm_belgium_social_dist))\nsol = solve(prob)\nplot(sol, leg = :topright)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Evaluation-Scenario-2","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/#Question-1","page":"Evaluation Scenario 2","title":"Question 1","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/#Ingest-SIDARTHE","page":"Evaluation Scenario 2","title":"Ingest SIDARTHE","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"This is the version directly from the SBML file. This will be replaced with a version from TA1/TA2 when available. This used our SBMLToolkit.jl library which reads SBML into ModelingToolkit and generates TeX'd versions of the equations so we could read the resulting model and confirm it is correct against the paper description.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"using EasyModelAnalysis, SBML, SBMLToolkit, UnPack, Test\n\nfn = \"Giordano2020.xml\"\n\nmyread(fn) = readSBML(fn, doc -> begin\n                          set_level_and_version(3, 2)(doc)\n                          convert_promotelocals_expandfuns(doc)\n                      end)\n\nm = myread(fn)\nrn = ReactionSystem(m)\nsys = convert(ODESystem, rn)\neqs = equations(sys)\ndefs_ = ModelingToolkit.defaults(sys)\ndefs = deepcopy(defs_)\nevs = ModelingToolkit.get_continuous_events(sys)\n\n@unpack Infected, Healed, Extinct, Diagnosed, Ailing, Recognized, Susceptible, Threatened = sys\n@unpack alpha, epsilon, gamma, beta, delta, mu, nu, lambda, rho, kappa, xi, sigma, zeta, eta, theta, tau = sys\nps = [alpha, epsilon, gamma, beta, delta, mu, nu, lambda, rho, kappa, xi, sigma, zeta, eta]\n\n@parameters t\nD = Differential(t)\neqs2 = deepcopy(eqs)\nappend!(eqs2, D.(ps) .~ 0)\n\nsys2 = ODESystem(eqs2, ModelingToolkit.get_iv(sys), states(sys), parameters(sys);\n                 continuous_events = evs, defaults = defs, name = nameof(sys))\nssys = structural_simplify(sys2)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Unit-Tests","page":"Evaluation Scenario 2","title":"Unit Tests","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/#Unit-Test-1","page":"Evaluation Scenario 2","title":"Unit Test 1","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Set the initial values and parameters, as described in the Supplementary Methods section of the publication (pg. 9 of the pdf):","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Initial Values: I = 200/60e6, D = 20/60e6, A = 1/60e6, R = 2/60e6, T = 0, H = 0, E = 0; S = 1 – I – D – A – R – T – H – E. Let total population = 60e6.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Parameters: α = 0.570, β = δ = 0.011, γ = 0.456, ε = 0.171, θ = 0.371, ζ = η = 0.125, μ = 0.017, ν = 0.027, τ = 0.01, λ = ρ = 0.034 and κ = ξ = σ = 0.017.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Simulate for 100 days, and determine the day and level of peak total infections (sum over all the infected states I, D, A, R, T). Expected output: The peak should occur around day 47, when ~60% of the population is infected.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"The SBML model that was given had a few oddities. First, it made use of delay blocks. These are usually used to describe a delay differential equation. While our simulator does have the capability to solve delay differential equations and their inverse problems, it turns out that this was an issue with the SBML writing of the model as all of the delay values were zero. Thus as a simplification, we manually deleted the delay blocks to give a standard ODE representation (since a delay of 0 on all states is mathematically equivalent).","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"The paper and SBML model also described time-dependent parameters. These are parameters that would discretely change at pre-specified time points. However, we believe that the evaluators and/or paper must have used an SBML reading system that incorrectly handled these time-dependent parameters. This is because dropping the time-dependency and treating the parameters as constant gives the requested results of the unit test 1. A demonstration of this is as follows:","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"sysne = ODESystem(eqs2, ModelingToolkit.get_iv(sys), states(sys), parameters(sys);\n                  defaults = defs, name = nameof(sys))\nssysne = structural_simplify(sysne)\nprobne = ODEProblem(ssysne, [], (0.0, 100.0))\nsolne = solve(probne, Tsit5())\nplot(solne)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"ITALY_POPULATION = 60e6\nidart = [Infected, Diagnosed, Ailing, Recognized, Threatened]\nxmax, xmaxval = get_max_t(probne, sum(idart))\n@test isapprox(xmax, 47; atol = 0.5)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"@test isapprox(xmaxval, 0.6, atol = 0.01)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Full-Analysis-of-the-Effect-of-Events","page":"Evaluation Scenario 2","title":"Full Analysis of the Effect of Events","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"The SBML model already contains the changes of parameters requested for Unit Test #2 in the form of events. In the SBML these are enclosed by the element listOfEvents. The ids correspond to the days of the introduction of government intervention as outlined in the paper. \"On day 4, R0 = 1.66 as a result of the introduction of basic social distancing, awareness of the epidemic, hygiene and behavioral recommendations, and early measures by the Italian government (for example, closing schools). At day 12, ... \". When we interpret the instructions \"Unit Test #1: Set the initial values and parameters, as desribed in the Supplementary Methods...\" as \"Set the initial values and set and maintain the paramters (i.e. simulate without government restrictions)...\" we have to remove the events from the model. If we do so, the unit tests pass.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"solne = solve(probne, Tsit5())\np = plot(solne, vars = idart)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"p = plot(solne.t, solne[sum(idart)])","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Unit-Test-2","page":"Evaluation Scenario 2","title":"Unit Test 2","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Now update the parameters to reflect various interventions that Italy implemented during the first wave, as described in detail on pg. 9.  Simulate for 100 days, reproduce the trajectories in Fig. 2B, and determine the day and level of peak total infections (sum over all the infected states I, D, A, R, T). Expected output: Trajectories in Fig. 2B, peak occurs around day 50, with ~0.2% of the total population infected.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"This unit test was a straightforward implementation of the scenario, requiring a named reparameterization. It makes use of the new ModelingToolkit feature designed for ASKEM, remake(prob, u0 = u0s, p = pars), which allows for a new ODE to be generated from the old ODE simply by mentioning which parameters need to be changed (all others are kept constant). The approximation tests on the bottom demonstrate that the results in Fig 2B are obtained.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"ITALY_POPULATION = 60e6\nu0s = [\n    Infected => 200 / ITALY_POPULATION,\n    Diagnosed => 20 / ITALY_POPULATION,\n    Ailing => 1 / ITALY_POPULATION,\n    Recognized => 2 / ITALY_POPULATION,\n    Threatened => 0,\n    Healed => 0,\n    Extinct => 0,\n]\npush!(u0s, Susceptible => 1 - sum(last.(u0s)))\n\n# The resulting basic reproduction number is R0 = 2.38.\npars = [alpha => 0.570, beta => 0.011, delta => 0.011, gamma => 0.456, epsilon => 0.171,\n    theta => 0.371,\n    zeta => 0.125, eta => 0.125, mu => 0.017, nu => 0.027, tau => 0.01,\n    lambda => 0.034, rho => 0.034, kappa => 0.017, xi => 0.017, sigma => 0.017]\nprob = ODEProblem(ssys, [], (0, 100))\nprob_test1 = remake(prob, u0 = u0s, p = pars)\nsolt1 = solve(prob_test1, Tsit5(); saveat = 0:100)\nog_states = states(sys)[1:8]\nidart = [Infected, Diagnosed, Ailing, Recognized, Threatened]\nplot(solt1; idxs = Infected)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plot(solt1; idxs = Diagnosed)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plot(solt1; idxs = idart)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"@test solt1[Infected + Healed] == solt1[Infected] + solt1[Healed]","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plot(solt1.t, solt1[sum(idart)] * ITALY_POPULATION; label = \"IDART absolute\")","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plot(solt1.t, solt1[sum(idart)]; label = \"IDART percent\")","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"xmax, xmaxval = get_max_t(prob_test1, sum(idart))\n\n@test isapprox(xmax, 47; atol = 4)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"@test isapprox(xmaxval, 0.002; atol = 0.01)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Sensitivity-Analysis","page":"Evaluation Scenario 2","title":"Sensitivity Analysis","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"The difference between 1.b.i and 1.b.ii are changes in some parameter values over time. Describe the difference in outcomes between b.i and b.ii. Perform a sensitivity analysis to understand the sensitivity of the model to parameter variations and determine which parameter(s) were most responsible for the change in outcomes.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"This analysis was a straightforward application of the get_sensitivity function in EasyModelAnalysis. The only issue was the creation of the bounds for the parameters, which was not given by the metadata from TA1/TA2. Thus we made a modeling choice that the viable parameter set is 50% below and 100% above the starting parameter choice. Future iterations of the modeling platform should preserve parameter bound data which would make this a one line analysis.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"A utility was added (https://github.com/SciML/EasyModelAnalysis.jl/pull/134) to make it so the sensitivity values did not need to be recreated for the plotting process. This was just a minor performance and \"niceity\" improvement. Polish.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"The sensitivity analysis needed 1000 samples, we reduced it to 200 due to memory limitations of our documentation building compute server.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"pbounds = [param => [\n               0.5 * ModelingToolkit.defaults(sys)[param],\n               2 * ModelingToolkit.defaults(sys)[param],\n           ] for param in parameters(sys2)]\nsensres = get_sensitivity(probne, 100.0, Infected, pbounds; samples = 200)\nsensres_vec = collect(sensres)\nsort(filter(x -> endswith(string(x[1]), \"_first_order\"), sensres_vec), by = x -> abs(x[2]),\n     rev = true)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"sort(filter(x -> endswith(string(x[1]), \"_second_order\"), sensres_vec), by = x -> abs(x[2]),\n     rev = true)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"sort(filter(x -> endswith(string(x[1]), \"_total_order\"), sensres_vec), by = x -> abs(x[2]),\n     rev = true)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"create_sensitivity_plot(sensres, pbounds)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Minimum-Parameter-Threshold","page":"Evaluation Scenario 2","title":"Minimum Parameter Threshold","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Now return to the situation in b.i (constant parameters that don’t change over time). Let’s say we want to increase testing, diagnostics, and contact tracing efforts (implemented by increasing the detection parameters ε and θ). Assume that θ >= 2* ε, because a symptomatic person is more likely to be tested. What minimum constant values do these parameters need to be over the course of a 100-day simulation, to ensure that the total infected population (sum over all the infected states I, D, A, R, T) never rises above 1/3 of the total population?","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"This scenario demonstrates the lazily defined observables functionality that persists throughout our simulation and analysis libraries. When one solves an equation with ModelingToolkit symbolic values, sol[x] gives the solution with respect to x by name. While that improves code legibility, sol[x+y] is also allowed, and will automatically generate the solution of x(t) + y(t) on demand. Since this functionality is directly handled by the solution representation, this means that all functions built on the solution have this functionality. Thus without having to make any other changes, we can change our minimization to the complex form (Infected + Diagnosed + Ailing + Recognized + Threatened) / sum(states(sys)) required by the scenario.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"However, this scenario also required making a modeling choice. In order to perform this minimization we needed, we needed to define the comparative cost between the different intervention parameters, epsilon and theta. We have made the assumption that the cost of interventions on these two parameters are the same, and have made requests to TA1/TA2 about the interpretation of these parameters for further information.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"threshold_observable = (Infected + Diagnosed + Ailing + Recognized + Threatened) /\n                       sum(states(sys))\ncost = -(epsilon + theta)\nineq_cons = [2 * epsilon - theta]\nopt_p, sol_opt_p, ret = optimal_parameter_threshold(probne, threshold_observable,\n                                                    0.33,\n                                                    cost, [epsilon, theta],\n                                                    [0.0, 0.0],\n                                                    3 .* [\n                                                        ModelingToolkit.defaults(sys)[epsilon],\n                                                        ModelingToolkit.defaults(sys)[theta],\n                                                    ];\n                                                    maxtime = 60,\n                                                    ineq_cons);\nopt_p","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plot(sol_opt_p, idxs = [threshold_observable], lab = \"total infected\", leg = :topright)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Question-2","page":"Evaluation Scenario 2","title":"Question 2","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/#Ingest-SIDARTHE-V","page":"Evaluation Scenario 2","title":"Ingest SIDARTHE-V","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"This is a handwritten verison of the SIDARTHE-V model, built from the exported SIDARTHE SBML and then manually handcorrected to be the SIDARTHE-V model. This should swap to the TA1/TA2 model form when available.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"sysv = eval(quote\n                var\"##iv#608\" = (@variables(t))[1]\n                var\"##sts#609\" = (collect)(@variables(Infected(t), Healed(t), Extinct(t),\n                                                      Diagnosed(t), Ailing(t),\n                                                      Recognized(t), Susceptible(t),\n                                                      Threatened(t), Vaccinated(t),\n                                                      alpha(t), epsilon(t), gamma(t),\n                                                      beta(t), delta(t), mu(t), nu(t),\n                                                      lambda(t), rho(t), kappa(t), xi(t),\n                                                      sigma(t), zeta(t), eta(t)))\n                var\"##ps#610\" = (collect)(@parameters(ModelValue_21, epsilon_modifier, tau,\n                                                      theta, ModelValue_19, ModelValue_20,\n                                                      Event_trigger_Fig4b,\n                                                      Event_trigger_Fig3d, ModelValue_16,\n                                                      Event_trigger_Fig3b, alpha_modifier,\n                                                      Event_trigger_Fig4d, ModelValue_17,\n                                                      ModelValue_18, Italy, tau1, phi))\n                var\"##eqs#611\" = [(~)((Differential(t))(Infected),\n                                      (+)((*)((+)((/)((*)(Infected, alpha), Italy),\n                                                  (/)((*)(Diagnosed, beta), Italy),\n                                                  (/)((*)(Ailing, gamma), Italy),\n                                                  (/)((*)(Recognized, delta), Italy)),\n                                              Susceptible), (*)(-1 // 1, Infected, epsilon),\n                                          (*)(-1 // 1, Infected, lambda),\n                                          (*)(-1 // 1, Infected, zeta)))\n                                  (~)((Differential(t))(Healed),\n                                      (+)((*)(Ailing, kappa), (*)(Diagnosed, rho),\n                                          (*)(Infected, lambda), (*)(Recognized, xi),\n                                          (*)(Threatened, sigma)))\n                                  (~)((Differential(t))(Extinct),\n                                      (*)(tau, Threatened) + tau1 * Recognized)\n                                  (~)((Differential(t))(Diagnosed),\n                                      (+)((*)(Infected, epsilon),\n                                          (*)(-1 // 1, Diagnosed, eta),\n                                          (*)(-1 // 1, Diagnosed, rho)))\n                                  (~)((Differential(t))(Ailing),\n                                      (+)((*)(Infected, zeta), (*)(-1 // 1, theta, Ailing),\n                                          (*)(-1 // 1, Ailing, kappa),\n                                          (*)(-1 // 1, Ailing, mu)))\n                                  (~)((Differential(t))(Recognized),\n                                      (+)((*)(theta, Ailing), (*)(Diagnosed, eta),\n                                          (*)(-1 // 1, Recognized, nu),\n                                          (*)(-1 // 1, Recognized, xi)))\n                                  (~)((Differential(t))(Susceptible),\n                                      (*)((+)((/)((*)(-1, Infected, alpha), Italy),\n                                              (/)((*)(-1, Diagnosed, beta), Italy),\n                                              (/)((*)(-1, Ailing, gamma), Italy),\n                                              (/)((*)(-1, Recognized, delta), Italy)) -\n                                          phi * Susceptible,\n                                          Susceptible))\n                                  (~)((Differential(t))(Threatened),\n                                      (+)((*)(Ailing, mu), (*)(Recognized, nu),\n                                          (*)(-1 // 1, tau, Threatened),\n                                          (*)(-1 // 1, Threatened, sigma)))\n                                  Differential(t)(Vaccinated) ~ phi * Susceptible\n                                  (~)((Differential(t))(alpha), -0.0);\n                                  (~)((Differential(t))(epsilon), -0.0);\n                                  (~)((Differential(t))(gamma), -0.0);\n                                  (~)((Differential(t))(beta), -0.0);\n                                  (~)((Differential(t))(delta), -0.0);\n                                  (~)((Differential(t))(mu), -0.0);\n                                  (~)((Differential(t))(nu), -0.0);\n                                  (~)((Differential(t))(lambda), -0.0);\n                                  (~)((Differential(t))(rho), -0.0);\n                                  (~)((Differential(t))(kappa), -0.0);\n                                  (~)((Differential(t))(xi), -0.0);\n                                  (~)((Differential(t))(sigma), -0.0);\n                                  (~)((Differential(t))(zeta), -0.0);\n                                  (~)((Differential(t))(eta), -0.0)]\n                var\"##defs#612\" = (Dict)((Pair)(delta, 0.011), (Pair)(xi, 0.017),\n                                         (Pair)(Diagnosed, 3.33333333e-7),\n                                         (Pair)(Event_trigger_Fig3b, 0.0),\n                                         (Pair)(Extinct, 0.0), (Pair)(kappa, 0.017),\n                                         (Pair)(zeta, 0.125), (Pair)(eta, 0.125),\n                                         (Pair)(nu, 0.027), (Pair)(Healed, 0.0),\n                                         (Pair)(Infected, 3.33333333e-6),\n                                         (Pair)(ModelValue_16, 0.0),\n                                         (Pair)(alpha_modifier, 1.0), (Pair)(Italy, 1.0),\n                                         (Pair)(Event_trigger_Fig3d, 0.0),\n                                         (Pair)(ModelValue_20, 1.0), (Pair)(sigma, 0.017),\n                                         (Pair)(Threatened, 0.0), (Pair)(lambda, 0.034),\n                                         (Pair)(alpha, 0.57),\n                                         (Pair)(Event_trigger_Fig4b, 0.0),\n                                         (Pair)(ModelValue_17, 0.0),\n                                         (Pair)(Event_trigger_Fig4d, 0.0),\n                                         (Pair)(Susceptible, 0.9999963),\n                                         (Pair)(beta, 0.011),\n                                         (Pair)(Recognized, 3.33333333e-8),\n                                         (Pair)(rho, 0.034), (Pair)(mu, 0.017),\n                                         (Pair)(epsilon, 0.171),\n                                         (Pair)(Ailing, 1.66666666e-8),\n                                         (Pair)(gamma, 0.456), (Pair)(ModelValue_19, 0.0),\n                                         (Pair)(ModelValue_21, 1.0), (Pair)(theta, 0.371),\n                                         (Pair)(epsilon_modifier, 1.0), (Pair)(tau, 0.01),\n                                         (Pair)(ModelValue_18, 0.0),\n                                         Vaccinated => 0,\n                                         tau1 => 0.0200,\n                                         phi => 0.0025)\n                var\"##iv#613\" = (@variables(t))[1]\n                (ODESystem)(var\"##eqs#611\", var\"##iv#613\", var\"##sts#609\", var\"##ps#610\";\n                            defaults = var\"##defs#612\", name = Symbol(\"##SBML#530\"),\n                            checks = false)\n            end)\n# todo set the event flags\n# todo validate the new params \nsysv = complete(sysv)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"probv = ODEProblem(sysv, [], (0, 100))\nsolv = solve(probv, Tsit5())\nplot(solv)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plot(solv, idxs = [og_states; Vaccinated])","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plot(solt1; idxs = sum(idart))","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"xmax, xmaxval = get_max_t(probv, sum(idart) * ITALY_POPULATION)\nxmax, xmaxval = get_max_t(probv, sum(idart))\n\n@test isapprox(xmax, 47; atol = 5)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"@test isapprox(xmaxval, 0.6; atol = 0.1)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#Setup-the-Parameters","page":"Evaluation Scenario 2","title":"Setup the Parameters","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Set the same initial values and parameter settings in 1.b.i. Let V(t=0) = 0, τ (in SIDARTHE) = τ2 (in SIDDARTHE-V), and τ1 = (1/3)*τ2 (reflecting the fact that the mortality rate for critical conditions (state T), will always be larger than for other infected states). Assume that the vaccination rate psi is 0 to start with. The SIDARTHE-V model allows for three main types of interventions: (1) Those that impact the transmission parameters (α, β, γ and δ) – social distancing, masking, lockdown; (2) Those that impact the detection parameters (ε, θ) – testing and contact tracing; (3) Those that impact the vaccination rate psi – vaccination campaigns. Assume previously stated constraints: θ >= 2* ε, and τ1 = (1/3)*τ2.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"# TODO: double check. I am assuming our `tau` is `tau1` and `tau1` is `tau2`.\ndefs_v2 = deepcopy(ModelingToolkit.defaults(sysv))\ndefs_v2[sysv.tau1] = defs[tau]\ndefs_v2[sysv.tau] = defs[tau] / 3\ndefs_v2[sysv.phi] = 0\nprobv2 = remake(probv; p = defs_v2)\nsolv2 = solve(probv2)\nplot(solv2)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#b.i","page":"Evaluation Scenario 2","title":"b.i","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Let’s say our goal is to ensure that the total infected population (sum over all the infected states I, D, A, R, T) never rises above 1/3 of the total population, over the course of the next 100 days. If you could choose only a single intervention (affecting only one parameter), which intervention would let us meet our goal, with minimal change to the intervention parameter? Assume that the intervention will be implemented after one month (t = day 30), and will stay constant after that, over the remaining time period (i.e. the following 70 days). What are equivalent interventions of the other two intervention types, that would have the same impact on total infections?","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"This is a straightforward usage of the EasyModelAnalysis.optimal_parameter_intervention_for_threshold function designed during the ASKEM hackathon. It was able to be used without modification. However, a modeling decision had to be made to define what the \"intervention parameters\" are. A data request back to TA1/TA2 has been made to define which parameters should be in this set.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"This example revealed a typo in our function (https://github.com/SciML/EasyModelAnalysis.jl/pull/135) which had to be fixed.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"threshold_observable = (Infected + Diagnosed + Ailing + Recognized + Threatened) /\n                       sum(states(sysv))\nplot(solv2, idxs = [threshold_observable], lab = \"total infected\")\nhline!([1 / 3], lab = \"limit\")","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"intervention_p = phi # Need to figure out what these should be\ncost = intervention_p - defs_v2[intervention_p]\nopt_p, solv2_s, ret = optimal_parameter_intervention_for_threshold(probv2,\n                                                                   threshold_observable,\n                                                                   0.33,\n                                                                   cost,\n                                                                   [intervention_p], [0.0],\n                                                                   [1.0],\n                                                                   (30.0, 100.0);\n                                                                   maxtime = 10);\nopt_p","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Note that the optimization solution is trivial, i.e. there's no intervention at all. This is expected because the model without any intervention would already have less than 1/3 of the population infected.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/#b.ii","page":"Evaluation Scenario 2","title":"b.ii","text":"","category":"section"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Let’s say our goal is to get the reproduction number R0 below 1.0, at some point within the next 100 days. Are there interventions that will allow us to meet our goal? If there are multiple options, which single intervention would have the greatest impact on R0 and let us meet our goal with minimal change to the intervention parameter? Assume that the intervention will be implemented after one month (t = day 30), and will stay constant after that, over the remaining time period (i.e. the following 70 days).","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"In order to do this scenario a modeling decision for how to represent R0 in terms of the states was required. This needed expert information, which we called out for and documented the results in https: //github.com/ChrisRackauckas/ASKEMEvaluationStaging/issues/20. This led us to a definition of the instantanious R0 as defined in https: //www.ncbi.nlm.nih.gov/pmc/articles/PMC7325187/ equation 1. However, the R computation requires the mean duration of infectiousness, we will use D=20 for now to have a non-trivial optimization. Thus using this definition of R0 and our intervention functionality designed to find parameters to keep a value below a threshold, we were able to solve for the intervention.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"Another modeling decision required here was the definition of intervention parameters, which we decided to use the same parameters as b.i.","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"D = 20\nR0 = sysv.alpha * sysv.Susceptible * D # double check\nplot(solv2, idxs = [R0])","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"intervention_parameters = [sysv.theta => (2 * defs_v2[sysv.eta], 1) # 𝜃 >= 2 * 𝜀\n                           sysv.eta => (0, defs_v2[sysv.theta] / 2)\n                           sysv.phi => (0, 1)]\nopt_results = map(intervention_parameters) do (intervention_p, bounds)\n    cost = intervention_p - defs_v2[intervention_p]\n    optimal_parameter_intervention_for_reach(probv2,\n                                             R0,\n                                             1.0,\n                                             cost,\n                                             [intervention_p], [bounds[1]], [bounds[2]],\n                                             (30.0, 100.0);\n                                             maxtime = 10)\nend;\nmap(first, opt_results)","category":"page"},{"location":"Scenario2/Evaluation_Scenario_2/","page":"Evaluation Scenario 2","title":"Evaluation Scenario 2","text":"plts = map(opt_results) do opt_result\n    title = only(collect(opt_result[1]))\n    title = title[1] => round(title[2], sigdigits = 3)\n    plot(opt_result[2][2]; idxs = [R0], lab = \"R0\", title)\n    hline!([1], lab = \"limit\")\nend\nplot(plts...)","category":"page"},{"location":"#DARPA-ASKEM-6-Month-Evaluations","page":"DARPA-ASKEM Evaluation","title":"DARPA ASKEM 6 Month Evaluations","text":"","category":"section"},{"location":"#Reproducing-the-Results","page":"DARPA-ASKEM Evaluation","title":"Reproducing the Results","text":"","category":"section"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"This system is a fully reproducer builder that generates the results from scratch. It downloads Julia, downloads the packages, builds the results, and then hosts them at the website  https://chrisrackauckas.github.io/ASKEMEvaluationStaging/dev/.","category":"page"},{"location":"#Running-the-Builder","page":"DARPA-ASKEM Evaluation","title":"Running the Builder","text":"","category":"section"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"The simplest way to reproduce the results is to run the builder by opening a PR. The Documentation job is the job generating the results, and if successful (green) then its artifacts are pushed to the repository on merge.","category":"page"},{"location":"#Running-Locally-via-the-make.jl-Script","page":"DARPA-ASKEM Evaluation","title":"Running Locally via the make.jl Script","text":"","category":"section"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"To run locally, start by downloading the Github repository and set the current directory to  ASKEM_Evaluation_Staging/docs. Then open Julia and run:","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"cd(\"to the ASKEM_Evaluation_Staging/docs directory\")\n\n# Setup packages\nusing Pkg\nPkg.activate(\".\") \nPkg.instantiate()\n\n# Run the build script\ninclude(\"make.jl\")","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"The outputs will be generated into the ASKEM_Evaluation_Staging/docs/build directory and can be opened in  a web browser.","category":"page"},{"location":"#Running-Individual-Files","page":"DARPA-ASKEM Evaluation","title":"Running Individual Files","text":"","category":"section"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"The individual files can be built as well by running the code in the Markdown files. We recommend grabbing the packages using the Project.toml via:","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"cd(\"to the ASKEM_Evaluation_Staging/docs directory\")\n\n# Setup packages\nusing Pkg\nPkg.activate(\".\") \nPkg.instantiate()","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"Then open up the .md and run the code! If using the Julia VS Code plugin then inline evaluation will directly work.","category":"page"},{"location":"#Contributing","page":"DARPA-ASKEM Evaluation","title":"Contributing","text":"","category":"section"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"Please refer to the SciML ColPrac: Contributor's Guide on Collaborative Practices for Community Packages for guidance on PRs, issues, and other matters relating to contributing to SciML.\nSee the SciML Style Guide for common coding practices and other style decisions.\nThere are a few community forums:\nThe #diffeq-bridged and #sciml-bridged channels in the Julia Slack\nThe #diffeq-bridged and #sciml-bridged channels in the Julia Zulip\nOn the Julia Discourse forums\nSee also SciML Community page","category":"page"},{"location":"#Reproducibility","page":"DARPA-ASKEM Evaluation","title":"Reproducibility","text":"","category":"section"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"<details><summary>The documentation of this SciML package was built using these direct dependencies,</summary>","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"using Pkg # hide\nPkg.status() # hide","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"</details>","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"<details><summary>and using this machine and Julia version.</summary>","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"using InteractiveUtils # hide\nversioninfo() # hide","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"</details>","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"<details><summary>A more complete overview of all dependencies and their versions is also provided.</summary>","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"using Pkg # hide\nPkg.status(; mode = PKGMODE_MANIFEST) # hide","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"</details>","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"You can also download the\n<a href=\"","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"using TOML\nversion = TOML.parse(read(\"../../Project.toml\", String))[\"version\"]\nname = TOML.parse(read(\"../../Project.toml\", String))[\"name\"]\nlink = \"https://github.com/SciML/\" * name * \".jl/tree/gh-pages/v\" * version *\n       \"/assets/Manifest.toml\"","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"\">manifest</a> file and the\n<a href=\"","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"using TOML\nversion = TOML.parse(read(\"../../Project.toml\", String))[\"version\"]\nname = TOML.parse(read(\"../../Project.toml\", String))[\"name\"]\nlink = \"https://github.com/SciML/\" * name * \".jl/tree/gh-pages/v\" * version *\n       \"/assets/Project.toml\"","category":"page"},{"location":"","page":"DARPA-ASKEM Evaluation","title":"DARPA-ASKEM Evaluation","text":"\">project</a> file.","category":"page"}]
}
